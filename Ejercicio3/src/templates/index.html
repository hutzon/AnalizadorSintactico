<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analizador Sintáctico - Ejercicio 3</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/material-darker.min.css"
    />
    <style>
      body {
        background-color: #f0f2f5;
        color: #333;
      }
      .container {
        max-width: 1200px;
      }
      .card {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }
      .CodeMirror {
        border-radius: 5px;
        border: 1px solid #ddd;
        height: 200px; /* Increased height */
      }
      .result-area {
        min-height: 100px;
        padding: 15px;
        border-radius: 5px;
        font-family: monospace;
      }
      .success {
        background-color: #e8f5e9;
        color: #2e7d32;
      }
      .error {
        background-color: #ffebee;
        color: #c62828;
      }
      .btn-group-examples .btn {
        margin-right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container my-5">
      <div class="row">
        <div class="col-lg-8">
          <div class="card">
            <div class="text-center">
              <h1 class="display-5">Analizador Sintáctico</h1>
              <p class="lead text-muted">
                Una herramienta para validar la sintaxis de un lenguaje simple.
              </p>
            </div>
            <div class="card-body">
              <form id="analyzeForm">
                <div class="mb-3">
                  <textarea id="codeInput"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-lg">
                  Analizar Código
                </button>
              </form>
            </div>
          </div>

          <div class="card mt-4">
            <div class="card-header bg-white border-bottom-0">
              <h5 class="mb-0">Resultado del Análisis</h5>
            </div>
            <div class="card-body">
              <div id="resultArea" class="result-area bg-light">
                <p class="text-muted">
                  El resultado del análisis se mostrará aquí...
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="card">
            <div class="card-header bg-white">
              <h5 class="mb-0">Ejemplos</h5>
            </div>
            <div class="card-body">
              <p class="text-muted">
                Carga ejemplos para probar el analizador.
              </p>
              <div class="d-grid gap-2">
                <button
                  class="btn btn-outline-secondary text-start"
                  onclick="loadExample(1)"
                >
                  Asignaciones simples
                </button>
                <button
                  class="btn btn-outline-secondary text-start"
                  onclick="loadExample(2)"
                >
                  Estructura 'if'
                </button>
                <button
                  class="btn btn-outline-secondary text-start"
                  onclick="loadExample(3)"
                >
                  Bucle 'while'
                </button>
                <button
                  class="btn btn-outline-danger text-start"
                  onclick="loadExample(4)"
                >
                  Código con error
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/clike/clike.min.js"></script>

    <script>
      // Inicialización de CodeMirror
      const editor = CodeMirror.fromTextArea(
        document.getElementById("codeInput"),
        {
          lineNumbers: true,
          mode: "text/x-csrc", // un modo similar nos puede servir
          theme: "material-darker",
          lineWrapping: true,
        },
      );

      // Función para cargar ejemplos
      function loadExample(exampleNum) {
        let exampleCode = "";
        switch (exampleNum) {
          case 1:
            exampleCode = "a = 5 + 3 * 2;\nb = (10 - 5) / 2.5;";
            break;
          case 2:
            exampleCode = "if (a < b) {\n    c = a + b;\n}";
            break;
          case 3:
            exampleCode =
              "while (a < b) {\n    if (2 * a >= b) {\n        b = 2;\n    }\n    a = a + 1;\n}";
            break;
          case 4:
            exampleCode = "if a < b) {\n    c = a + b;\n}"; // Error de sintaxis
            break;
        }
        editor.setValue(exampleCode);
      }

      // Manejo del formulario con AJAX
      $("#analyzeForm").submit(function (e) {
        e.preventDefault();
        const code = editor.getValue();
        if (!code.trim()) {
          alert("Por favor, ingrese código para analizar.");
          return;
        }

        $.ajax({
          url: "/analyze",
          method: "POST",
          data: { code: code },
          beforeSend: function () {
            $("#resultArea").html('<p class="text-center">Analizando...</p>');
          },
          success: function (response) {
            if (response.success) {
              $("#resultArea").html(
                '<div class="success p-3 rounded">' +
                  response.message +
                  "</div>",
              );
            } else {
              let errorHtml =
                '<div class="error p-3 rounded"><strong>Errores encontrados:</strong><ul class="mb-0">';
              response.errors.forEach(function (error) {
                errorHtml += "<li>" + error + "</li>";
              });
              errorHtml += "</ul></div>";
              $("#resultArea").html(errorHtml);
            }
          },
          error: function () {
            $("#resultArea").html(
              '<div class="error p-3 rounded">Error al comunicarse con el servidor.</div>',
            );
          },
        });
      });

      // Cargar un ejemplo por defecto al iniciar
      loadExample(1);
    </script>
  </body>
</html>
